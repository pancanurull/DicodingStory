/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){var t,n,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return r(l,"_invoke",function(e,r,o){var i,a,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,a=0,c=t,p.n=r,u}};function y(e,r){for(a=e,c=r,n=0;!f&&s&&!o&&n<l.length;n++){var o,i=l[n],y=p.p,d=i[2];e>3?(o=d===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=e<2&&y<i[1])?(a=0,p.v=r,p.n=i[1]):y<d&&(o=e<3||i[0]>r||r>d)&&(i[4]=e,i[5]=r,p.n=d,a=0))}if(o||e>1)return u;throw f=!0,r}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),a=l,c=d;(n=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(p.n=-1),y(a,c)):p.n=c:p.v=c);try{if(s=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(f=p.n<0)?c:e.call(r,p))!==u)break}catch(e){i=t,a=1,c=e}finally{s=1}}return{value:n,done:f}}}(e,i,a),!0),l}var u={};function s(){}function l(){}function f(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),y=f.prototype=s.prototype=Object.create(p);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,r(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,r(y,"constructor",f),r(f,"constructor",l),l.displayName="GeneratorFunction",r(f,a,"GeneratorFunction"),r(y),r(y,a,"Generator"),r(y,i,function(){return this}),r(y,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:d}})()}function r(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}r=function(t,e,n,o){if(e)i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n;else{var a=function(e,n){r(t,e,function(t){return this._invoke(e,n,t)})};a("next",0),a("throw",1),a("return",2)}},r(t,e,n,o)}function n(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise(function(o,i){var a=t.apply(e,r);function c(t){n(a,o,i,c,u,"next",t)}function u(t){n(a,o,i,c,u,"throw",t)}c(void 0)})}}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var c=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.routes=new Map,this.currentRoute=null},r=[{key:"init",value:function(){var t=this;this.handleRouteChange(),window.addEventListener("hashchange",function(){t.handleRouteChange()})}},{key:"addRoute",value:function(t,e){this.routes.set(t,e)}},{key:"getCurrentRoute",value:function(){return window.location.hash.substring(1)||"home"}},{key:"navigate",value:function(t){var e=this;t!==this.currentRoute&&("startViewTransition"in document?document.startViewTransition(function(){e.currentRoute=t,window.location.hash="home"===t?"":t}):(this.currentRoute=t,window.location.hash="home"===t?"":t))}},{key:"updateActiveNavLink",value:function(t){document.querySelectorAll(".nav-link").forEach(function(e){e.classList.remove("active"),e.dataset.page===t&&e.classList.add("active")})}},{key:"navigateWithTransition",value:(a=o(e().m(function t(r,n){var i,a,c=this;return e().w(function(t){for(;;)switch(t.n){case 0:if(r!==this.currentRoute){t.n=1;break}return t.a(2);case 1:if(!("startViewTransition"in document)){t.n=2;break}return i=document.startViewTransition(o(e().m(function t(){var o;return e().w(function(t){for(;;)switch(t.n){case 0:if(c.currentRoute=r,window.location.hash="home"===r?"":r,document.documentElement.style.viewTransitionName="page",c.updateActiveNavLink(r),document.querySelectorAll(".page-section").forEach(function(t){t.classList.remove("active")}),(o=document.getElementById("".concat(r,"-page")))&&o.classList.add("active"),!n){t.n=1;break}return t.n=1,n();case 1:return t.a(2)}},t)}))),t.a(2,i);case 2:if(this.currentRoute=r,window.location.hash="home"===r?"":r,this.updateActiveNavLink(r),document.querySelectorAll(".page-section").forEach(function(t){t.classList.remove("active")}),(a=document.getElementById("".concat(r,"-page")))&&a.classList.add("active"),!n){t.n=3;break}return t.n=3,n();case 3:return t.a(2)}},t,this)})),function(t,e){return a.apply(this,arguments)})},{key:"handleRouteChange",value:(n=o(e().m(function t(){var r,n,o;return e().w(function(t){for(;;)switch(t.n){case 0:if((r=this.getCurrentRoute())===this.currentRoute){t.n=1;break}if(this.currentRoute=r,this.updateActiveNavLink(r),document.querySelectorAll(".page-section").forEach(function(t){t.classList.remove("active")}),(n=document.getElementById("".concat(r,"-page")))?n.classList.add("active"):document.getElementById("not-found-page").classList.add("active"),!(o=this.routes.get(r)||this.routes.get(""))){t.n=1;break}return t.n=1,o();case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})}],r&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,a}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(u(t)+" is not iterable")}function l(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return f(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(f(e={},n,function(){return this}),e),y=s.prototype=c.prototype=Object.create(p);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,f(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return u.prototype=s,f(y,"constructor",s),f(s,"constructor",u),u.displayName="GeneratorFunction",f(s,o,"GeneratorFunction"),f(y),f(y,o,"Generator"),f(y,n,function(){return this}),f(y,"toString",function(){return"[object Generator]"}),(l=function(){return{w:i,m:d}})()}function f(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}f=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){f(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},f(t,e,r,n)}function p(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function y(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){p(i,n,o,a,c,"next",t)}function c(t){p(i,n,o,a,c,"throw",t)}a(void 0)})}}function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach(function(e){h(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function h(t,e,r){return(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function b(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var g=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.baseURL="https://story-api.dicoding.dev/v1",this.defaultHeaders={"Content-Type":"application/json"}},e=[{key:"getAuthHeaders",value:function(t){return v(v({},this.defaultHeaders),{},{Authorization:"Bearer ".concat(t)})}},{key:"request",value:(h=y(l().m(function t(e){var r,n,o,i,a,c,u=arguments;return l().w(function(t){for(;;)switch(t.n){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},t.p=1,n="".concat(this.baseURL).concat(e),(o=v(v({},r),{},{headers:v({},r.headers)})).body instanceof FormData?o.headers["Content-Type"]&&delete o.headers["Content-Type"]:o.headers["Content-Type"]="application/json",t.n=2,fetch(n,o);case 2:if((i=t.v).ok){t.n=7;break}return t.n=3,i.json().catch(function(){return{}});case 3:if(a=t.v,401!==i.status){t.n=4;break}throw new Error("Email atau password salah");case 4:if(404!==i.status){t.n=5;break}throw new Error("Email belum terdaftar");case 5:if(400!==i.status){t.n=6;break}throw new Error(a.message||"Data login tidak valid");case 6:throw new Error(a.message||"Error: ".concat(i.status," ").concat(i.statusText));case 7:return t.n=8,i.json();case 8:return t.a(2,t.v);case 9:throw t.p=9,c=t.v,console.error("API Request failed for ".concat(e,":"),c),c;case 10:return t.a(2)}},t,this,[[1,9]])})),function(t){return h.apply(this,arguments)})},{key:"register",value:(d=y(l().m(function t(e){return l().w(function(t){for(;;)if(0===t.n)return t.a(2,this.request("/register",{method:"POST",body:JSON.stringify(e)}))},t,this)})),function(t){return d.apply(this,arguments)})},{key:"login",value:(p=y(l().m(function t(e){return l().w(function(t){for(;;)if(0===t.n)return t.a(2,this.request("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})}))},t,this)})),function(t){return p.apply(this,arguments)})},{key:"getStories",value:(f=y(l().m(function t(){var e,r,n,o,i=arguments;return l().w(function(t){for(;;)if(0===t.n)return e=i.length>0&&void 0!==i[0]?i[0]:{},r=new URLSearchParams,e.page&&r.append("page",e.page),e.size&&r.append("size",e.size),void 0!==e.location&&r.append("location",e.location),n=r.toString(),o="/stories".concat(n?"?".concat(n):""),t.a(2,this.request(o,{headers:e.token?this.getAuthHeaders(e.token):this.defaultHeaders}))},t,this)})),function(){return f.apply(this,arguments)})},{key:"getStoryDetail",value:(u=y(l().m(function t(e,r){return l().w(function(t){for(;;)if(0===t.n)return t.a(2,this.request("/stories/".concat(e),{headers:this.getAuthHeaders(r)}))},t,this)})),function(t,e){return u.apply(this,arguments)})},{key:"addStory",value:(c=y(l().m(function t(e,r){var n;return l().w(function(t){for(;;)if(0===t.n)return n={Authorization:"Bearer ".concat(r)},t.a(2,this.request("/stories",{method:"POST",headers:n,body:e}))},t,this)})),function(t,e){return c.apply(this,arguments)})},{key:"addStoryGuest",value:(a=y(l().m(function t(e){return l().w(function(t){for(;;)if(0===t.n)return t.a(2,this.request("/stories/guest",{method:"POST",body:e}))},t,this)})),function(t){return a.apply(this,arguments)})},{key:"subscribeNotification",value:(i=y(l().m(function t(e,r){var n,o;return l().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,console.log("[API] Sending subscription data:",e),t.n=1,this.request("/notifications/subscribe",{method:"POST",headers:this.getAuthHeaders(r),body:JSON.stringify(e)});case 1:return n=t.v,console.log("[API] Subscription response:",n),t.a(2,n);case 2:throw t.p=2,o=t.v,console.error("[API] Subscription error:",o),o;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t,e){return i.apply(this,arguments)})},{key:"unsubscribeNotification",value:(o=y(l().m(function t(e,r){return l().w(function(t){for(;;)if(0===t.n)return t.a(2,this.request("/notifications/subscribe",{method:"DELETE",headers:this.getAuthHeaders(r),body:JSON.stringify(e)}))},t,this)})),function(t,e){return o.apply(this,arguments)})},{key:"validateResponse",value:function(t){if(!t||t.error)throw new Error((null==t?void 0:t.message)||"Invalid response from server");return t}},{key:"handleNetworkError",value:(n=y(l().m(function t(e){return l().w(function(t){for(;;)switch(t.n){case 0:if(navigator.onLine){t.n=1;break}throw new Error("Tidak ada koneksi internet. Periksa koneksi Anda.");case 1:if("TypeError"!==e.name||!e.message.includes("fetch")){t.n=2;break}throw new Error("Gagal terhubung ke server. Coba lagi nanti.");case 2:throw e;case 3:return t.a(2)}},t)})),function(t){return n.apply(this,arguments)})},{key:"requestWithRetry",value:(r=y(l().m(function t(e){var r,n,o,i,a,c,u=this,f=arguments;return l().w(function(t){for(;;)switch(t.n){case 0:r=f.length>1&&void 0!==f[1]?f[1]:{},n=f.length>2&&void 0!==f[2]?f[2]:3,i=l().m(function t(i){var a,c;return l().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,u.request(e,r);case 1:return a=t.v,t.a(2,{v:a});case 2:if(t.p=2,c=t.v,o=c,!c.message.includes("HTTP 4")){t.n=3;break}throw c;case 3:if(!(i<n-1)){t.n=4;break}return t.n=4,new Promise(function(t){return setTimeout(t,1e3*(i+1))});case 4:return t.a(2)}},t,null,[[0,2]])}),c=0;case 1:if(!(c<n)){t.n=4;break}return t.d(s(i(c)),2);case 2:if(!(a=t.v)){t.n=3;break}return t.a(2,a.v);case 3:c++,t.n=1;break;case 4:throw o;case 5:return t.a(2)}},t)})),function(t){return r.apply(this,arguments)})}],e&&m(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u,f,p,d,h}();function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,S(n.key),n)}}function S(t){var e=function(t){if("object"!=w(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}var j=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tokenKey="dicoding_stories_token",this.userKey="dicoding_stories_user"},e=[{key:"saveToken",value:function(t){try{return localStorage.setItem(this.tokenKey,t),!0}catch(t){return console.error("Failed to save token:",t),!1}}},{key:"getToken",value:function(){try{return localStorage.getItem(this.tokenKey)}catch(t){return console.error("Failed to get token:",t),null}}},{key:"removeToken",value:function(){try{return localStorage.removeItem(this.tokenKey),!0}catch(t){return console.error("Failed to remove token:",t),!1}}},{key:"saveUser",value:function(t){try{return localStorage.setItem(this.userKey,JSON.stringify(t)),!0}catch(t){return console.error("Failed to save user:",t),!1}}},{key:"getUser",value:function(){try{var t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}catch(t){return console.error("Failed to get user:",t),null}}},{key:"removeUser",value:function(){try{return localStorage.removeItem(this.userKey),!0}catch(t){return console.error("Failed to remove user:",t),!1}}},{key:"isAuthenticated",value:function(){var t=this.getToken();return null!==t&&""!==t}},{key:"clearAll",value:function(){try{return this.removeToken(),this.removeUser(),!0}catch(t){return console.error("Failed to clear all data:",t),!1}}},{key:"set",value:function(t,e){try{var r="string"==typeof e?e:JSON.stringify(e);return localStorage.setItem(t,r),!0}catch(e){return console.error("Failed to store ".concat(t,":"),e),!1}}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var r=localStorage.getItem(t);if(null===r)return e;try{return JSON.parse(r)}catch(t){return r}}catch(r){return console.error("Failed to get ".concat(t,":"),r),e}}},{key:"remove",value:function(t){try{return localStorage.removeItem(t),!0}catch(e){return console.error("Failed to remove ".concat(t,":"),e),!1}}},{key:"isAvailable",value:function(){try{var t="__storage_test__";return localStorage.setItem(t,"test"),localStorage.removeItem(t),!0}catch(t){return!1}}}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const O="https://story-api.dicoding.dev/v1";function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function P(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return T(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(T(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,T(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,T(f,"constructor",s),T(s,"constructor",u),u.displayName="GeneratorFunction",T(s,o,"GeneratorFunction"),T(f),T(f,o,"Generator"),T(f,n,function(){return this}),T(f,"toString",function(){return"[object Generator]"}),(P=function(){return{w:i,m:p}})()}function T(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}T=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){T(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},T(t,e,r,n)}function A(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function F(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){A(i,n,o,a,c,"next",t)}function c(t){A(i,n,o,a,c,"throw",t)}a(void 0)})}}function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_(n.key),n)}}function _(t){var e=function(t){if("object"!=E(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==E(e)?e:e+""}var x=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"isOnline",value:(n=F(P().m(function t(){var e,r,n,o,i;return P().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,e=(new j).getToken(),r=e?{Authorization:"Bearer ".concat(e)}:{},n="API_BASE_URL"===O?"https://story-api.dicoding.dev/v1":O,t.n=1,fetch("".concat(n,"/stories?size=1"),{method:"GET",headers:r});case 1:return o=t.v,t.a(2,o.ok);case 2:return t.p=2,i=t.v,console.error("Connection check failed:",i),t.a(2,!1)}},t,null,[[0,2]])})),function(){return n.apply(this,arguments)})},{key:"checkConnection",value:(r=F(P().m(function t(){return P().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.isOnline();case 1:if(t.v){t.n=2;break}throw new Error("Tidak ada koneksi internet. Periksa jaringan Anda.");case 2:return t.a(2,!0)}},t,this)})),function(){return r.apply(this,arguments)})}],e&&G(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function N(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return C(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(C(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,C(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,C(f,"constructor",s),C(s,"constructor",u),u.displayName="GeneratorFunction",C(s,o,"GeneratorFunction"),C(f),C(f,o,"Generator"),C(f,n,function(){return this}),C(f,"toString",function(){return"[object Generator]"}),(N=function(){return{w:i,m:p}})()}function C(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}C=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){C(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},C(t,e,r,n)}function D(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function B(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){D(i,n,o,a,c,"next",t)}function c(t){D(i,n,o,a,c,"throw",t)}a(void 0)})}}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,R(n.key),n)}}function R(t){var e=function(t){if("object"!=I(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==I(e)?e:e+""}var U=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dbName="DicodingStoriesDB",this.storeName="stories",this.db=null},e=[{key:"initDB",value:(l=B(N().m(function t(){var e=this;return N().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,r){var n=indexedDB.open(e.dbName,3);n.onerror=function(t){console.error("Database error:",t.target.error),r(t.target.error)},n.onsuccess=function(r){e.db=r.target.result,t(e.db)},n.onupgradeneeded=function(t){var r=t.target.result;if(!r.objectStoreNames.contains(e.storeName)){var n=r.createObjectStore(e.storeName,{keyPath:"id"});n.createIndex("createdAt","createdAt",{unique:!1}),n.createIndex("hasLocation","hasLocation",{unique:!1})}r.objectStoreNames.contains("favorites")||r.createObjectStore("favorites",{keyPath:"id"})}}))},t)})),function(){return l.apply(this,arguments)})},{key:"saveStory",value:(s=B(N().m(function t(e){var r,n=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,r){var o=n.db.transaction([n.storeName],"readwrite");o.oncomplete=function(){return t()},o.onerror=function(t){return r(t.target.error)},o.objectStore(n.storeName).put(e)}));case 2:throw t.p=2,r=t.v,console.error("Failed to save story:",r),r;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return s.apply(this,arguments)})},{key:"getStories",value:(u=B(N().m(function t(){var e,r=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,e){var n=r.db.transaction([r.storeName],"readonly").objectStore(r.storeName).getAll();n.onsuccess=function(){return t(n.result||[])},n.onerror=function(t){console.error("Error getting stories:",t.target.error),e(t.target.error)}}));case 2:throw t.p=2,e=t.v,console.error("Error in getStories:",e),e;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return u.apply(this,arguments)})},{key:"deleteStory",value:(c=B(N().m(function t(e){var r=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,n){var o=r.db.transaction([r.storeName],"readwrite").objectStore(r.storeName).delete(e);o.onsuccess=function(){return t()},o.onerror=function(t){return n(t.target.error)}}))}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"clearAll",value:(a=B(N().m(function t(){var e=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,r){var n=e.db.transaction([e.storeName],"readwrite").objectStore(e.storeName).clear();n.onsuccess=function(){return t()},n.onerror=function(t){return r(t.target.error)}}))}},t,this)})),function(){return a.apply(this,arguments)})},{key:"saveFavorite",value:(i=B(N().m(function t(e){var r,n=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,r){var o=n.db.transaction(["favorites"],"readwrite");o.oncomplete=function(){return t()},o.onerror=function(t){return r(t.target.error)},o.objectStore("favorites").put(e)}));case 2:throw t.p=2,r=t.v,console.error("Failed to save favorite:",r),r;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return i.apply(this,arguments)})},{key:"getFavorites",value:(o=B(N().m(function t(){var e,r=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,e){var n=r.db.transaction(["favorites"],"readonly").objectStore("favorites").getAll();n.onsuccess=function(){return t(n.result||[])},n.onerror=function(t){return e(t.target.error)}}));case 2:throw t.p=2,e=t.v,console.error("Failed to get favorites:",e),e;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"deleteFavorite",value:(n=B(N().m(function t(e){var r,n=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,r){var o=n.db.transaction(["favorites"],"readwrite").objectStore("favorites").delete(e);o.onsuccess=function(){return t()},o.onerror=function(t){return r(t.target.error)}}));case 2:throw t.p=2,r=t.v,console.error("Failed to delete favorite:",r),r;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return n.apply(this,arguments)})},{key:"isFavorite",value:(r=B(N().m(function t(e){var r,n=this;return N().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.db){t.n=1;break}return t.n=1,this.initDB();case 1:return t.a(2,new Promise(function(t,r){var o=n.db.transaction(["favorites"],"readonly").objectStore("favorites").get(e);o.onsuccess=function(){return t(!!o.result)},o.onerror=function(t){return r(t.target.error)}}));case 2:throw t.p=2,r=t.v,console.error("Failed to check favorite:",r),r;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return r.apply(this,arguments)})}],e&&M(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u,s,l}();function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function q(t){return function(t){if(Array.isArray(t))return K(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||V(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=V(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function V(t,e){if(t){if("string"==typeof t)return K(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?K(t,e):void 0}}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function W(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return J(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(J(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,J(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,J(f,"constructor",s),J(s,"constructor",u),u.displayName="GeneratorFunction",J(s,o,"GeneratorFunction"),J(f),J(f,o,"Generator"),J(f,n,function(){return this}),J(f,"toString",function(){return"[object Generator]"}),(W=function(){return{w:i,m:p}})()}function J(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}J=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){J(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},J(t,e,r,n)}function $(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function Q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$(Object(r),!0).forEach(function(e){X(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function X(t,e,r){return(e=et(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Y(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Z(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){Y(i,n,o,a,c,"next",t)}function c(t){Y(i,n,o,a,c,"throw",t)}a(void 0)})}}function tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,et(n.key),n)}}function et(t){var e=function(t){if("object"!=H(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=H(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==H(e)?e:e+""}var rt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiService=new g,this.storageService=new j,this.storyDB=new U},e=[{key:"getAllStories",value:(s=Z(W().m(function t(){var e,r,n,o,i,a,c,u,s=arguments;return W().w(function(t){for(;;)switch(t.n){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:{},t.p=1,t.n=2,x.checkConnection();case 2:return r=this.storageService.getToken(),n=Q(Q({},e),r&&{token:r}),t.n=3,this.apiService.getStories(n);case 3:return o=t.v,i=o.listStory||[],t.n=4,this.saveStoriesToDB(i);case 4:return t.a(2,Q(Q({},o),{},{listStory:i}));case 5:return t.p=5,u=t.v,console.error("Failed to get stories from API, trying from DB:",u),t.n=6,this.getStoriesFromDB();case 6:return a=t.v,c=this.transformStoryData(a),t.a(2,{listStory:c,message:"Anda sedang offline, menampilkan data terakhir yang tersedia"})}},t,this,[[1,5]])})),function(){return s.apply(this,arguments)})},{key:"saveStoriesToDB",value:(u=Z(W().m(function t(e){var r,n,o,i,a;return W().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.storyDB.initDB();case 1:r=z(e),t.p=2,r.s();case 3:if((n=r.n()).done){t.n=5;break}return o=n.value,t.n=4,this.storyDB.saveStory(Q(Q({},o),{},{hasLocation:o.lat&&o.lon}));case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,i=t.v,r.e(i);case 7:return t.p=7,r.f(),t.f(7);case 8:t.n=10;break;case 9:t.p=9,a=t.v,console.error("Failed to save stories to DB:",a);case 10:return t.a(2)}},t,this,[[2,6,7,8],[0,9]])})),function(t){return u.apply(this,arguments)})},{key:"getStoriesFromDB",value:(c=Z(W().m(function t(){var e,r;return W().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.storyDB.initDB();case 1:return t.n=2,this.storyDB.getStories();case 2:return e=t.v,t.a(2,this.transformStoryData(e));case 3:return t.p=3,r=t.v,console.error("Failed to get stories from DB:",r),t.a(2,[])}},t,this,[[0,3]])})),function(){return c.apply(this,arguments)})},{key:"getStoriesWithLocation",value:(a=Z(W().m(function t(){var e,r,n;return W().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.getAllStories({location:1});case 1:return e=t.v,r=e.listStory.filter(function(t){return null!==t.lat&&null!==t.lon}),t.a(2,Q(Q({},e),{},{listStory:r}));case 2:if(t.p=2,n=t.v,console.error("Failed to get stories with location:",n),!n.message.includes("Gagal memuat stories")){t.n=3;break}throw new Error("Gagal memuat stories dengan lokasi. "+n.message.split(":")[1]);case 3:throw new Error("Gagal memuat stories dengan lokasi. Silakan coba lagi.");case 4:return t.a(2)}},t,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"getFeaturedStories",value:(i=Z(W().m(function t(){var e,r,n,o,i=arguments;return W().w(function(t){for(;;)switch(t.n){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:6,t.p=1,t.n=2,this.getAllStories({size:e});case 2:if((r=t.v).listStory&&0!==r.listStory.length){t.n=3;break}throw new Error("Tidak ada featured stories yang tersedia");case 3:return n=r.listStory.slice(0,e),t.a(2,Q(Q({},r),{},{listStory:n}));case 4:if(t.p=4,o=t.v,console.error("Failed to get featured stories:",o),!o.message.includes("Tidak ada")){t.n=5;break}throw o;case 5:throw new Error("Gagal memuat featured stories: "+(o.message||"Silakan coba lagi."));case 6:return t.a(2)}},t,this,[[1,4]])})),function(){return i.apply(this,arguments)})},{key:"getStoryDetail",value:(o=Z(W().m(function t(e){var r,n,o;return W().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,x.checkConnection();case 1:if(r=this.storageService.getToken()){t.n=2;break}throw new Error("Anda harus login untuk melihat detail story.");case 2:if(e&&"string"==typeof e){t.n=3;break}throw new Error("ID story tidak valid");case 3:return t.n=4,this.apiService.getStoryDetail(e,r);case 4:if((n=t.v)&&n.story){t.n=5;break}throw new Error("Format response detail tidak valid");case 5:return t.a(2,Q(Q({},n),{},{story:this.transformStoryData([n.story])[0]}));case 6:if(t.p=6,o=t.v,console.error("Failed to get story detail:",o),!o.message.includes("404")){t.n=7;break}throw new Error("Story tidak ditemukan. ID mungkin tidak valid.");case 7:if(!o.message.includes("403")){t.n=8;break}throw new Error("Anda tidak memiliki akses untuk melihat story ini.");case 8:throw new Error("Gagal memuat detail story: "+(o.message||"Silakan coba lagi."));case 9:return t.a(2)}},t,this,[[0,6]])})),function(t){return o.apply(this,arguments)})},{key:"addNewStory",value:(n=Z(W().m(function t(e){var r,n,o,i,a,c;return W().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,x.checkConnection();case 1:if(r=this.storageService.getToken(),!((n=this.validateStoryData(e)).length>0)){t.n=2;break}throw new Error(n.join(", "));case 2:if((o=new FormData).append("description",e.description),o.append("photo",e.photo),e.lat&&e.lon&&(o.append("lat",e.lat),o.append("lon",e.lon)),!r){t.n=4;break}return t.n=3,this.apiService.addStory(o,r);case 3:i=t.v,t.n=6;break;case 4:return t.n=5,this.apiService.addStoryGuest(o);case 5:i=t.v;case 6:if(i&&!i.error){t.n=7;break}throw new Error((null===(a=i)||void 0===a?void 0:a.message)||"Failed to add story");case 7:return t.a(2,i);case 8:throw t.p=8,c=t.v,console.error("Failed to add story:",c),c;case 9:return t.a(2)}},t,this,[[0,8]])})),function(t){return n.apply(this,arguments)})},{key:"validateStoryData",value:function(t){var e=[];if((!t.description||t.description.trim().length<10)&&e.push("Deskripsi minimal 10 karakter."),t.photo?(t.photo.size>1048576&&e.push("Ukuran foto maksimal 1MB."),t.photo.type.startsWith("image/")||e.push("File harus berupa gambar (JPEG, PNG, dll).")):e.push("Foto wajib diupload."),void 0!==t.lat||void 0!==t.lon){var r=parseFloat(t.lat),n=parseFloat(t.lon);isNaN(r)?e.push("Latitude tidak valid."):(r<-90||r>90)&&e.push("Latitude harus antara -90 sampai 90."),isNaN(n)?e.push("Longitude tidak valid."):(n<-180||n>180)&&e.push("Longitude harus antara -180 sampai 180.")}return e}},{key:"transformStoryData",value:function(t){var e=this;return Array.isArray(t)?t.map(function(t){var r={id:t.id||"unknown",name:t.name||"Anonymous",description:t.description||"Tidak ada deskripsi",photoUrl:t.photoUrl||"data:image/svg+xml,...",createdAt:t.createdAt||(new Date).toISOString(),lat:void 0!==t.lat?t.lat:null,lon:void 0!==t.lon?t.lon:null};return Q(Q({},r),{},{formattedDate:e.formatDate(r.createdAt),shortDescription:e.truncateText(r.description,100),hasLocation:null!==r.lat&&null!==r.lon})}):[]}},{key:"formatDate",value:function(t){try{var e=new Date(t);if(isNaN(e.getTime()))throw new Error("Invalid date");return e.toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Error formatting date:",t),"Tanggal tidak tersedia"}}},{key:"truncateText",value:function(t,e){return t&&"string"==typeof t?t.length<=e?t:t.substring(0,e)+"...":""}},{key:"searchStories",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!Array.isArray(t))return[];if(!e||"string"!=typeof e)return q(t);var r=e.toLowerCase().trim();return t.filter(function(t){var e,n,o=(null===(e=t.name)||void 0===e?void 0:e.toLowerCase())||"",i=(null===(n=t.description)||void 0===n?void 0:n.toLowerCase())||"";return o.includes(r)||i.includes(r)})}},{key:"filterStoriesByLocation",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Array.isArray(t)?t.filter(function(t){var r=null!==t.lat&&null!==t.lon;return e?r:!r}):[]}},{key:"sortStories",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newest";if(!Array.isArray(t))return[];var r=q(t);switch(e){case"newest":return r.sort(function(t,e){var r=new Date(t.createdAt||0);return new Date(e.createdAt||0)-r});case"oldest":return r.sort(function(t,e){return new Date(t.createdAt||0)-new Date(e.createdAt||0)});case"name":return r.sort(function(t,e){var r,n,o=(null===(r=t.name)||void 0===r?void 0:r.toLowerCase())||"",i=(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||"";return o.localeCompare(i)});default:return r}}},{key:"syncOfflineStories",value:(r=Z(W().m(function t(){var e,r,n,o,i,a,c;return W().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.storyDB.getStories();case 1:if(!((e=t.v).length>0)){t.n=9;break}r=this.storageService.getToken(),n=z(e),t.p=2,n.s();case 3:if((o=n.n()).done){t.n=6;break}return i=o.value,t.n=4,this.apiService.addStory(i,r);case 4:return t.n=5,this.storyDB.deleteStory(i.id);case 5:t.n=3;break;case 6:t.n=8;break;case 7:t.p=7,a=t.v,n.e(a);case 8:return t.p=8,n.f(),t.f(8);case 9:t.n=11;break;case 10:t.p=10,c=t.v,console.error("Sync failed:",c);case 11:return t.a(2)}},t,this,[[2,7,8,9],[0,10]])})),function(){return r.apply(this,arguments)})}],e&&tt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u,s}();function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function ot(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return it(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(it(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,it(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,it(f,"constructor",s),it(s,"constructor",u),u.displayName="GeneratorFunction",it(s,o,"GeneratorFunction"),it(f),it(f,o,"Generator"),it(f,n,function(){return this}),it(f,"toString",function(){return"[object Generator]"}),(ot=function(){return{w:i,m:p}})()}function it(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}it=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){it(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},it(t,e,r,n)}function at(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ut(n.key),n)}}function ut(t){var e=function(t){if("object"!=nt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=nt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nt(e)?e:e+""}var st=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.view=r},e=[{key:"loadFeaturedStories",value:(r=ot().m(function t(){var e,r,n;return ot().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,this.view.showLoading(),t.n=1,this.model.getFeaturedStories();case 1:if((e=t.v)&&e.listStory&&0!==e.listStory.length){t.n=2;break}return this.view.renderEmptyState(),t.a(2);case 2:r=this.model.transformStoryData(e.listStory),this.view.renderFeaturedStories(r),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Error loading featured stories:",n),this.view.handleError(n);case 4:return t.a(2)}},t,this,[[0,3]])}),n=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){at(i,n,o,a,c,"next",t)}function c(t){at(i,n,o,a,c,"throw",t)}a(void 0)})},function(){return n.apply(this,arguments)})}],e&&ct(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function lt(t){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(t)}function ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pt(n.key),n)}}function pt(t){var e=function(t){if("object"!=lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=lt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lt(e)?e:e+""}var yt=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.story=e,this.isFavorite=r,this.onFavoriteToggle=n},e=[{key:"render",value:function(){var t=this,e=document.createElement("article");e.className="glass-card story-card",e.dataset.storyId=this.story.id,e.setAttribute("role","article"),e.setAttribute("aria-label","Cerita oleh ".concat(this.story.name));var r=this.story.lat&&this.story.lon,n=r?'<i class="fas fa-map-marker-alt" aria-hidden="true"></i>':"",o=this.isFavorite?"fas":"far",i=this.isFavorite?"gold":"#aaa";e.innerHTML='\n            <img \n                src="'.concat(this.story.photoUrl,'" \n                alt="Story oleh ').concat(this.story.name,"\"\n                class=\"story-card-img\"\n                loading=\"lazy\"\n                onerror=\"this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'300\\' height=\\'200\\' viewBox=\\'0 0 300 200\\'%3E%3Crect width=\\'300\\' height=\\'200\\' fill=\\'%23667eea\\'/%3E%3Ctext x=\\'50%\\' y=\\'50%\\' font-size=\\'16\\' text-anchor=\\'middle\\' fill=\\'white\\'%3EGambar tidak tersedia%3C/text%3E%3C/svg%3E'\">\n            <div class=\"story-card-content\">\n                <div class=\"story-card-user\">\n                    <img src=\"/icons/user.png\" alt=\"").concat(this.story.name,'" class="story-card-user-img" />\n                    <span class="story-card-user-name">').concat(this.story.name,'</span>\n                    <span class="story-card-date">').concat(this.story.formattedDate||"Tanggal tidak tersedia",'</span>\n                </div>\n                <div class="story-card-desc">').concat(this.story.description||"Tidak ada deskripsi","</div>\n                ").concat(r?'<div class="story-card-location">'.concat(n," Lokasi tersedia</div>"):"",'\n                <div class="story-card-actions">\n                    <button class="favorite-btn" aria-label="Favoritkan cerita ini" style="color:').concat(i,'"><i class="').concat(o,' fa-star"></i></button>\n                    <button aria-label="Bagikan cerita"><i class="fas fa-share-alt"></i></button>\n                </div>\n            </div>\n        ');var a=e.querySelector(".favorite-btn");return a&&"function"==typeof this.onFavoriteToggle&&a.addEventListener("click",function(e){e.preventDefault(),t.onFavoriteToggle(t.story,!t.isFavorite,a)}),e}}],e&&ft(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function dt(t){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dt(t)}function vt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return ht(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(ht(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,ht(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,ht(f,"constructor",s),ht(s,"constructor",u),u.displayName="GeneratorFunction",ht(s,o,"GeneratorFunction"),ht(f),ht(f,o,"Generator"),ht(f,n,function(){return this}),ht(f,"toString",function(){return"[object Generator]"}),(vt=function(){return{w:i,m:p}})()}function ht(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ht=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){ht(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},ht(t,e,r,n)}function mt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,gt(n.key),n)}}function gt(t){var e=function(t){if("object"!=dt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=dt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dt(e)?e:e+""}var wt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new rt,this.presenter=new st(this.model,this),this.featuredStoriesContainer=null},e=[{key:"render",value:(r=vt().m(function t(){return vt().w(function(t){for(;;)switch(t.n){case 0:if(this.featuredStoriesContainer=document.getElementById("featured-stories"),!this.featuredStoriesContainer){t.n=1;break}return t.n=1,this.presenter.loadFeaturedStories();case 1:return t.a(2)}},t,this)}),n=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){mt(i,n,o,a,c,"next",t)}function c(t){mt(i,n,o,a,c,"throw",t)}a(void 0)})},function(){return n.apply(this,arguments)})},{key:"showLoading",value:function(){this.featuredStoriesContainer&&(this.featuredStoriesContainer.innerHTML='\n                <div class="loading" role="status" aria-label="Memuat featured stories">\n                    <div class="spinner"></div>\n                    <p>Memuat cerita terbaru...</p>\n                </div>\n            ')}},{key:"handleError",value:function(t){t.message.includes("koneksi internet")?this.renderError("Tidak ada koneksi internet. Periksa jaringan Anda."):t.message.includes("Sesi telah berakhir")?(this.renderError("Sesi Anda telah berakhir. Silakan login kembali."),this.navigateToLoginAfterDelay()):this.renderError(t.message||"Gagal memuat cerita terbaru. Silakan coba lagi.")}},{key:"navigateToLoginAfterDelay",value:function(){setTimeout(function(){window.location.hash="login"},3e3)}},{key:"renderFeaturedStories",value:function(t){var e=this;this.featuredStoriesContainer&&(t&&0!==t.length?(this.featuredStoriesContainer.innerHTML="",t.forEach(function(t){var r=new yt(t);e.featuredStoriesContainer.appendChild(r.render())}),this.addStoryCardListeners()):this.renderEmptyState())}},{key:"renderEmptyState",value:function(){this.featuredStoriesContainer&&(this.featuredStoriesContainer.innerHTML='\n            <div class="empty-state" role="alert" aria-label="Tidak ada cerita yang tersedia">\n                <i class="fas fa-book-open fa-3x" aria-hidden="true"></i>\n                <h3>Belum ada cerita</h3>\n                <p>Mulailah dengan membagikan cerita Anda sendiri!</p>\n                <div class="empty-actions">\n                    '.concat(this.model.isAuthenticated()?'\n                    <button class="btn btn-primary" onclick="navigateToPage(\'add-story\')">\n                        <i class="fas fa-plus"></i> Tambah Cerita\n                    </button>\n                    ':'\n                    <button class="btn btn-primary" onclick="navigateToPage(\'login\')">\n                        <i class="fas fa-sign-in-alt"></i> Login untuk Membagikan Cerita\n                    </button>\n                    ','\n                    <button class="btn btn-secondary" onclick="navigateToPage(\'stories\')">\n                        <i class="fas fa-book-reader"></i> Lihat Semua Cerita\n                    </button>\n                </div>\n            </div>\n        '))}},{key:"renderError",value:function(t){this.featuredStoriesContainer&&(this.featuredStoriesContainer.innerHTML='\n            <div class="error-message" role="alert">\n                <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>\n                <h3>Terjadi Kesalahan</h3>\n                <p>'.concat(t||"Gagal memuat cerita terbaru.",'</p>\n                <div class="error-actions">\n                    <button class="btn btn-primary" onclick="location.reload()">\n                        <i class="fas fa-sync-alt"></i> Coba Lagi\n                    </button>\n                    <button class="btn btn-secondary" onclick="navigateToPage(\'stories\')">\n                        <i class="fas fa-book-open"></i> Lihat Semua Cerita\n                    </button>\n                </div>\n            </div>\n        '))}},{key:"addStoryCardListeners",value:function(){this.featuredStoriesContainer.querySelectorAll(".story-card").forEach(function(t){t.addEventListener("click",function(e){if(!e.target.closest(".story-actions")){var r=t.dataset.storyId;console.log("View story ".concat(r))}})})}}],e&&bt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function St(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return jt(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(jt(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,jt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,jt(f,"constructor",s),jt(s,"constructor",u),u.displayName="GeneratorFunction",jt(s,o,"GeneratorFunction"),jt(f),jt(f,o,"Generator"),jt(f,n,function(){return this}),jt(f,"toString",function(){return"[object Generator]"}),(St=function(){return{w:i,m:p}})()}function jt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}jt=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){jt(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},jt(t,e,r,n)}function Ot(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Pt(n.key),n)}}function Pt(t){var e=function(t){if("object"!=kt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kt(e)?e:e+""}var Tt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.view=r},e=[{key:"loadAllStories",value:(r=St().m(function t(){var e,r,n,o;return St().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,this.view.showLoading(),t.n=1,this.model.getAllStories({location:1});case 1:if((e=t.v)&&e.listStory){t.n=2;break}throw new Error("Invalid API response format");case 2:if((r=this.model.transformStoryData(e.listStory))&&0!==r.length){t.n=3;break}return this.view.renderEmptyState(),t.a(2);case 3:this.view.renderAllStories(r),t.n=5;break;case 4:t.p=4,o=t.v,console.error("Error loading stories:",{message:o.message,stack:o.stack,timestamp:(new Date).toISOString()}),n="Gagal memuat stories. Silakan coba lagi.",o.message.includes("NetworkError")?n="Gagal terhubung ke internet. Periksa koneksi Anda.":o.message.includes("401")&&(n="Sesi telah berakhir. Silakan login kembali."),this.view.renderError(n);case 5:return t.p=5,this.view.hideLoading(),t.f(5);case 6:return t.a(2)}},t,this,[[0,4,5,6]])}),n=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Ot(i,n,o,a,c,"next",t)}function c(t){Ot(i,n,o,a,c,"throw",t)}a(void 0)})},function(){return n.apply(this,arguments)})}],e&&Et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function At(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ft(n.key),n)}}function Ft(t){var e=function(t){if("object"!=Lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Lt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}var Gt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mapContainerId=e,this.map=null,this.markers=[],this.tileLayers={standard:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),satellite:L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),dark:L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'})}},(e=[{key:"addTileLayers",value:function(){this.tileLayers.standard.addTo(this.map),L.control.layers(this.tileLayers).addTo(this.map)}},{key:"initMap",value:function(t,e){var r=document.getElementById(this.mapContainerId);r&&null!=r._leaflet_id&&(r._leaflet_id=null),this.map&&(this.map.remove(),this.map=null),this.map=L.map(this.mapContainerId).setView(t,e),this.tileLayers.standard.addTo(this.map),L.control.layers(this.tileLayers).addTo(this.map)}},{key:"addMarker",value:function(t,e){var r=L.marker(t).addTo(this.map);return e&&r.bindPopup(e),this.markers.push(r),r}},{key:"clearMarkers",value:function(){var t=this;this.markers.forEach(function(e){return t.map.removeLayer(e)}),this.markers=[]}},{key:"fitToMarkers",value:function(){if(0!==this.markers.length){var t=new L.featureGroup(this.markers);this.map.fitBounds(t.getBounds(),{padding:[50,50]})}}},{key:"setView",value:function(t,e){this.map.setView(t,e)}}])&&At(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function xt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return It(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?It(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function It(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Nt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Ct(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Ct(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ct(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ct(f,"constructor",s),Ct(s,"constructor",u),u.displayName="GeneratorFunction",Ct(s,o,"GeneratorFunction"),Ct(f),Ct(f,o,"Generator"),Ct(f,n,function(){return this}),Ct(f,"toString",function(){return"[object Generator]"}),(Nt=function(){return{w:i,m:p}})()}function Ct(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ct=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){Ct(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},Ct(t,e,r,n)}function Dt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Bt(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){Dt(i,n,o,a,c,"next",t)}function c(t){Dt(i,n,o,a,c,"throw",t)}a(void 0)})}}function Mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rt(n.key),n)}}function Rt(t){var e=function(t){if("object"!=_t(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=_t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_t(e)?e:e+""}var Ut=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new rt,this.presenter=new Tt(this.model,this),this.mapService=new Gt("stories-map"),this.storiesContainer=null},e=[{key:"render",value:(n=Bt(Nt().m(function t(){return Nt().w(function(t){for(;;)switch(t.n){case 0:return this.storiesContainer=document.getElementById("stories-container"),this.initMap(),t.n=1,this.presenter.loadAllStories();case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"updateMapWithStories",value:function(t){var e=this;t&&0!==t.length&&(this.mapService.clearMarkers(),t.forEach(function(t){var r='\n                <div class="map-popup">\n                    <img src="'.concat(t.photoUrl,'" alt="').concat(t.name,'" class="map-popup-image">\n                    <h4>').concat(t.name,"</h4>\n                    <p>").concat(t.description||"Tidak ada deskripsi","</p>\n                    <small>").concat(t.formattedDate||"","</small>\n                </div>\n            ");e.mapService.addMarker([t.lat,t.lon],r)}),t.length>1?this.mapService.fitToMarkers():1===t.length&&this.mapService.setView([t[0].lat,t[0].lon],13))}},{key:"showLoading",value:function(){document.getElementById("stories-loading").style.display="flex"}},{key:"hideLoading",value:function(){document.getElementById("stories-loading").style.display="none"}},{key:"renderAllStories",value:(r=Bt(Nt().m(function t(e){var r,n,o,i,a,c,u=this;return Nt().w(function(t){for(;;)switch(t.n){case 0:if(this.storiesContainer){t.n=1;break}return t.a(2);case 1:if(e&&0!==e.length){t.n=2;break}return this.renderEmptyState(),t.a(2);case 2:this.storiesContainer.innerHTML="",r=xt(e),t.p=3,r.s();case 4:if((n=r.n()).done){t.n=7;break}return o=n.value,t.n=5,this.model.storyDB.isFavorite(o.id);case 5:i=t.v,a=new yt(o,i,function(){var t=Bt(Nt().m(function t(e,r,n){return Nt().w(function(t){for(;;)switch(t.n){case 0:if(!r){t.n=2;break}return t.n=1,u.model.storyDB.saveFavorite(e);case 1:n.style.color="gold",n.querySelector("i").classList.remove("far"),n.querySelector("i").classList.add("fas"),t.n=4;break;case 2:return t.n=3,u.model.storyDB.deleteFavorite(e.id);case 3:n.style.color="#aaa",n.querySelector("i").classList.remove("fas"),n.querySelector("i").classList.add("far");case 4:return t.a(2)}},t)}));return function(e,r,n){return t.apply(this,arguments)}}()),this.storiesContainer.appendChild(a.render());case 6:t.n=4;break;case 7:t.n=9;break;case 8:t.p=8,c=t.v,r.e(c);case 9:return t.p=9,r.f(),t.f(9);case 10:this.updateMapWithStories(e.filter(function(t){return t.lat&&t.lon}));case 11:return t.a(2)}},t,this,[[3,8,9,10]])})),function(t){return r.apply(this,arguments)})},{key:"renderEmptyState",value:function(){this.storiesContainer.innerHTML='\n            <div class="empty-state" role="alert" aria-label="Tidak ada cerita yang tersedia">\n                <i class="fas fa-book-open" aria-hidden="true"></i>\n                <h3>Belum ada cerita</h3>\n                <p>Jadilah yang pertama membagikan cerita Anda!</p>\n                <button class="btn btn-primary" onclick="navigateToPage(\'add-story\')">\n                    <i class="fas fa-plus" aria-hidden="true"></i> Tambah Cerita\n                </button>\n            </div>\n        '}},{key:"renderError",value:function(t){this.storiesContainer.innerHTML='\n            <div class="error-message" role="alert">\n                <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>\n                <p>'.concat(t||"Gagal memuat cerita. Silakan coba lagi.",'</p>\n                <button class="btn btn-secondary" onclick="location.reload()">\n                    <i class="fas fa-sync-alt" aria-hidden="true"></i> Muat Ulang\n                </button>\n            </div>\n        ')}},{key:"initMap",value:function(){this.mapService.initMap([-2.5489,118.0149],5)}}],e&&Mt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Ht(t){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht(t)}function qt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return zt(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(zt(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,zt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,zt(f,"constructor",s),zt(s,"constructor",u),u.displayName="GeneratorFunction",zt(s,o,"GeneratorFunction"),zt(f),zt(f,o,"Generator"),zt(f,n,function(){return this}),zt(f,"toString",function(){return"[object Generator]"}),(qt=function(){return{w:i,m:p}})()}function zt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}zt=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){zt(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},zt(t,e,r,n)}function Vt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wt(n.key),n)}}function Wt(t){var e=function(t){if("object"!=Ht(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ht(e)?e:e+""}var Jt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.view=r},e=[{key:"addNewStory",value:(r=qt().m(function t(e){var r,n,o;return qt().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,this.view.showLoading(),!((r=this.model.validateStoryData(e)).length>0)){t.n=1;break}throw new Error(r[0]);case 1:return t.n=2,this.model.addNewStory(e);case 2:n=t.v,this.view.showSuccess(n.message),t.n=4;break;case 3:t.p=3,o=t.v,console.error("Error adding story:",o),this.view.showError(o.message);case 4:return t.p=4,this.view.hideLoading(),t.f(4);case 5:return t.a(2)}},t,this,[[0,3,4,5]])}),n=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){Vt(i,n,o,a,c,"next",t)}function c(t){Vt(i,n,o,a,c,"throw",t)}a(void 0)})},function(t){return n.apply(this,arguments)})}],e&&Kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function $t(t){return $t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$t(t)}function Qt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function Xt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Qt(Object(r),!0).forEach(function(e){Yt(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function Yt(t,e,r){return(e=oe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return te(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(te(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,te(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,te(f,"constructor",s),te(s,"constructor",u),u.displayName="GeneratorFunction",te(s,o,"GeneratorFunction"),te(f),te(f,o,"Generator"),te(f,n,function(){return this}),te(f,"toString",function(){return"[object Generator]"}),(Zt=function(){return{w:i,m:p}})()}function te(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}te=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){te(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},te(t,e,r,n)}function ee(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function re(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){ee(i,n,o,a,c,"next",t)}function c(t){ee(i,n,o,a,c,"throw",t)}a(void 0)})}}function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,oe(n.key),n)}}function oe(t){var e=function(t){if("object"!=$t(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=$t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$t(e)?e:e+""}var ie=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new rt,this.presenter=new Jt(this.model,this),this.mapService=new Gt("location-map"),this.photoData=null,this.selectedLocation=null,this.stream=null,this.setupPageUnloadHandler()},e=[{key:"setupPageUnloadHandler",value:function(){var t=this;window.addEventListener("hashchange",function(){t.cleanupCamera()}),window.addEventListener("beforeunload",function(){return t.cleanupCamera()}),window.addEventListener("pagehide",function(){return t.cleanupCamera()})}},{key:"cleanupCamera",value:function(){this.stream&&(this.stream.getTracks().forEach(function(t){return t.stop()}),this.stream=null)}},{key:"render",value:(n=re(Zt().m(function t(){var e;return Zt().w(function(t){for(;;)switch(t.n){case 0:(e=document.getElementById("add-story-page"))&&(e.innerHTML='\n                <form id="add-story-form">\n                    <div>\n                        <label for="story-description">Deskripsi</label>\n                        <textarea id="story-description" required minlength="10" placeholder="Tulis cerita Anda..."></textarea>\n                    </div>\n                    <div>\n                        <button type="button" id="start-camera">Gunakan Kamera</button>\n                        <button type="button" id="choose-file">Pilih Foto</button>\n                        <input type="file" id="file-input" accept="image/*" style="display:none" />\n                    </div>\n                    <div>\n                        <video id="camera-preview" autoplay playsinline style="display:none;width:100%;max-width:300px;"></video>\n                        <canvas id="captured-photo" style="display:none;width:100%;max-width:300px;"></canvas>\n                        <img id="photo-preview" style="display:none;width:100%;max-width:300px;" />\n                        <button type="button" id="capture-photo" style="display:none">Ambil Foto</button>\n                        <button type="button" id="retake-photo" style="display:none">Ulangi Foto</button>\n                    </div>\n                    <div>\n                        <label for="location-search">Pilih lokasimu sekarang</label>\n                        <input type="text" id="location-search" placeholder="Cari lokasi..." style="width:100%;margin-bottom:8px;padding:8px;border-radius:8px;border:1px solid #eee;" />\n                        <div id="selected-location"></div>\n                        <div id="location-map" style="height:200px;margin-bottom:10px;"></div>\n                    </div>\n                    <button id="submit-story" type="submit">Kirim Story</button>\n                </form>\n            '),this.initForm(),this.initMap(),this.initCamera(),this.initLocationSearch();case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"initForm",value:function(){var t=this;document.getElementById("add-story-form").addEventListener("submit",function(){var e=re(Zt().m(function e(r){return Zt().w(function(e){for(;;)switch(e.n){case 0:return r.preventDefault(),e.n=1,t.handleSubmit();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"initMap",value:function(){var t=this;this.mapService.initMap([-6.2088,106.8456],10),this.mapService.map.on("click",function(e){t.selectedLocation=e.latlng,document.getElementById("selected-location").textContent="Lokasi terpilih: ".concat(e.latlng.lat.toFixed(4),", ").concat(e.latlng.lng.toFixed(4)),t.mapService.clearMarkers(),t.mapService.addMarker(e.latlng,"Lokasi cerita Anda")})}},{key:"initCamera",value:function(){var t=this,e=document.getElementById("start-camera"),r=document.getElementById("capture-photo"),n=document.getElementById("retake-photo"),o=document.getElementById("choose-file"),i=document.getElementById("file-input"),a=document.getElementById("camera-preview"),c=document.getElementById("captured-photo"),u=document.getElementById("photo-preview");e.addEventListener("click",re(Zt().m(function n(){var i;return Zt().w(function(n){for(;;)switch(n.n){case 0:return n.p=0,n.n=1,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});case 1:t.stream=n.v,a.srcObject=t.stream,a.style.display="block",u.style.display="none",c.style.display="none",e.style.display="none",r.style.display="inline-block",o.style.display="inline-block",n.n=3;break;case 2:n.p=2,i=n.v,console.error("Error accessing camera:",i),t.showError("Tidak dapat mengakses kamera. Pastikan Anda memberikan izin.");case 3:return n.a(2)}},n,null,[[0,2]])}))),r.addEventListener("click",function(){c.width=a.videoWidth,c.height=a.videoHeight,c.getContext("2d").drawImage(a,0,0),c.toBlob(function(e){t.photoData=new File([e],"story-photo.jpg",{type:"image/jpeg"})},"image/jpeg",.8),c.style.display="block",a.style.display="none",r.style.display="none",n.style.display="inline-block"}),n.addEventListener("click",function(){c.style.display="none",a.style.display="block",n.style.display="none",r.style.display="inline-block",t.photoData=null}),o.addEventListener("click",function(){i.click()}),i.addEventListener("change",function(o){if(o.target.files&&o.target.files[0]){t.photoData=o.target.files[0],t.stream&&(t.stream.getTracks().forEach(function(t){return t.stop()}),t.stream=null);var i=new FileReader;i.onload=function(t){u.src=t.target.result,u.style.display="block",a.style.display="none",c.style.display="none",e.style.display="inline-block",r.style.display="none",n.style.display="inline-block"},i.readAsDataURL(o.target.files[0])}})}},{key:"initLocationSearch",value:function(){var t=document.getElementById("location-search"),e=this.mapService;if(t&&e&&e.map){var r=null;t.addEventListener("input",function(){clearTimeout(r);var t=this.value.trim();t.length<3||(r=setTimeout(re(Zt().m(function r(){var n,o,i,a,c;return Zt().w(function(r){for(;;)switch(r.n){case 0:return n="https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(t)),r.n=1,fetch(n);case 1:return o=r.v,r.n=2,o.json();case 2:(i=r.v)&&i.length>0&&(a=parseFloat(i[0].lat),c=parseFloat(i[0].lon),e.map.setView([a,c],14),e.clearMarkers(),e.addMarker([a,c],"Hasil pencarian"));case 3:return r.a(2)}},r)})),600))})}}},{key:"handleSubmit",value:(r=re(Zt().m(function t(){var e,r;return Zt().w(function(t){for(;;)switch(t.n){case 0:if((e=document.getElementById("story-description").value)&&!(e.trim().length<10)){t.n=1;break}return this.showError("Deskripsi minimal 10 karakter"),t.a(2);case 1:if(this.photoData){t.n=2;break}return this.showError("Foto wajib diupload"),t.a(2);case 2:return r=Xt({description:e.trim(),photo:this.photoData},this.selectedLocation&&{lat:parseFloat(this.selectedLocation.lat).toFixed(6),lon:parseFloat(this.selectedLocation.lng).toFixed(6)}),t.n=3,this.presenter.addNewStory(r);case 3:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"showLoading",value:function(){var t=document.getElementById("submit-story");t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Mengirim...'}},{key:"hideLoading",value:function(){var t=document.getElementById("submit-story");t.disabled=!1,t.innerHTML='<i class="fas fa-paper-plane" aria-hidden="true"></i> Kirim Story'}},{key:"showSuccess",value:function(t){var e=document.getElementById("add-story-form"),r=document.createElement("div");r.className="success-message",r.innerHTML='\n            <i class="fas fa-check-circle"></i>\n            <p>'.concat(t||"Story berhasil ditambahkan!","</p>\n        "),e.prepend(r),this.resetForm(),setTimeout(function(){r.remove()},5e3)}},{key:"showError",value:function(t){var e=document.getElementById("add-story-form"),r=document.createElement("div");r.className="error-message",r.innerHTML='\n            <i class="fas fa-exclamation-circle"></i>\n            <p>'.concat(t||"Gagal menambahkan story. Silakan coba lagi.","</p>\n        "),e.prepend(r),setTimeout(function(){r.remove()},5e3)}},{key:"resetForm",value:function(){document.getElementById("story-description").value="",document.getElementById("selected-location").textContent="";var t=document.getElementById("camera-preview"),e=document.getElementById("captured-photo"),r=document.getElementById("photo-preview");t.style.display="none",e.style.display="none",r.style.display="none",this.stream&&(this.stream.getTracks().forEach(function(t){return t.stop()}),this.stream=null),document.getElementById("start-camera").style.display="inline-block",document.getElementById("capture-photo").style.display="none",document.getElementById("retake-photo").style.display="none",this.photoData=null,this.selectedLocation=null,this.mapService.clearMarkers()}}],e&&ne(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function ce(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ue(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return se(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(se(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,se(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,se(f,"constructor",s),se(s,"constructor",u),u.displayName="GeneratorFunction",se(s,o,"GeneratorFunction"),se(f),se(f,o,"Generator"),se(f,n,function(){return this}),se(f,"toString",function(){return"[object Generator]"}),(ue=function(){return{w:i,m:p}})()}function se(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}se=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){se(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},se(t,e,r,n)}function le(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function fe(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){le(i,n,o,a,c,"next",t)}function c(t){le(i,n,o,a,c,"throw",t)}a(void 0)})}}function pe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ye(n.key),n)}}function ye(t){var e=function(t){if("object"!=ae(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ae(e)?e:e+""}var de=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiService=new g,this.storageService=new j},e=[{key:"login",value:(n=fe(ue().m(function t(e){var r,n,o,i,a,c,u;return ue().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,!((r=this.validateLoginData(e)).length>0)){t.n=1;break}throw new Error(r[0]);case 1:return t.n=2,this.apiService.login(e);case 2:if((n=t.v)&&n.loginResult&&n.loginResult.token){t.n=3;break}throw new Error("Login gagal: Response tidak valid dari server");case 3:return o=n.loginResult,i=o.token,a=o.userId,c=o.name,this.storageService.saveToken(i),this.storageService.saveUser({userId:a,name:c,email:e.email}),t.a(2,{success:!0,user:{userId:a,name:c,email:e.email},message:"Login berhasil!"});case 4:throw t.p=4,u=t.v,console.error("Login failed:",u),new Error(u.message||"Login gagal. Periksa email dan password Anda.");case 5:return t.a(2)}},t,this,[[0,4]])})),function(t){return n.apply(this,arguments)})},{key:"register",value:(r=fe(ue().m(function t(e){var r,n,o,i;return ue().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,!((r=this.validateRegisterData(e)).length>0)){t.n=1;break}throw new Error(r[0]);case 1:return t.n=2,this.apiService.register(e);case 2:return n=t.v,o=this.apiService.validateResponse(n),t.a(2,{success:!0,message:o.message||"Registrasi berhasil! Silakan login."});case 3:if(t.p=3,i=t.v,console.error("Registration failed:",i),!i.message.includes("email")){t.n=4;break}throw new Error("Email sudah terdaftar. Gunakan email lain.");case 4:throw new Error(i.message||"Registrasi gagal. Silakan coba lagi.");case 5:return t.a(2)}},t,this,[[0,3]])})),function(t){return r.apply(this,arguments)})},{key:"logout",value:function(){try{return this.storageService.clearAll(),{success:!0,message:"Logout berhasil!"}}catch(t){throw console.error("Logout failed:",t),new Error("Logout gagal.")}}},{key:"getCurrentUser",value:function(){return this.storageService.getUser()}},{key:"isAuthenticated",value:function(){return this.storageService.isAuthenticated()}},{key:"getAuthToken",value:function(){return this.storageService.getToken()}},{key:"validateLoginData",value:function(t){var e=[];return t.email&&t.email.trim()?this.isValidEmail(t.email)||e.push("Format email tidak valid."):e.push("Email wajib diisi."),t.password&&t.password.trim()?t.password.length<8&&e.push("Password minimal 8 karakter."):e.push("Password wajib diisi."),e}},{key:"validateRegisterData",value:function(t){var e=[];if(t.name&&t.name.trim()?t.name.trim().length<2&&e.push("Nama minimal 2 karakter."):e.push("Nama wajib diisi."),t.email&&t.email.trim()?this.isValidEmail(t.email)||e.push("Format email tidak valid."):e.push("Email wajib diisi."),t.password&&t.password.trim()){var r=this.validatePassword(t.password);e.push.apply(e,function(t){return function(t){if(Array.isArray(t))return ce(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ce(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(r))}else e.push("Password wajib diisi.");return e}},{key:"validatePassword",value:function(t){var e=[];return t.length<8&&e.push("Password minimal 8 karakter."),/(?=.*[a-z])/.test(t)||e.push("Password harus mengandung huruf kecil."),/(?=.*[A-Z])/.test(t)||e.push("Password harus mengandung huruf besar."),/(?=.*\d)/.test(t)||e.push("Password harus mengandung angka."),e}},{key:"isValidEmail",value:function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}}],e&&pe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function ve(t){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve(t)}function he(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return me(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(me(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,me(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,me(f,"constructor",s),me(s,"constructor",u),u.displayName="GeneratorFunction",me(s,o,"GeneratorFunction"),me(f),me(f,o,"Generator"),me(f,n,function(){return this}),me(f,"toString",function(){return"[object Generator]"}),(he=function(){return{w:i,m:p}})()}function me(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}me=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){me(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},me(t,e,r,n)}function be(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ge(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){be(i,n,o,a,c,"next",t)}function c(t){be(i,n,o,a,c,"throw",t)}a(void 0)})}}function we(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ke(n.key),n)}}function ke(t){var e=function(t){if("object"!=ve(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ve(e)?e:e+""}var Se=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.view=r},e=[{key:"loginUser",value:(n=ge(he().m(function t(e){var r,n,o,i;return he().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,e.email&&e.password){t.n=1;break}throw new Error("Email dan password harus diisi");case 1:return this.view.showLoginLoading(),r=Date.now(),t.n=2,this.model.login(e);case 2:if(n=t.v,!((o=Date.now()-r)<2e3)){t.n=4;break}return t.n=3,new Promise(function(t){return setTimeout(t,2e3-o)});case 3:t.n=5;break;case 4:case 5:n.success?(this.model.storageService.saveToken(this.model.getAuthToken()),this.model.storageService.saveUser(n.user),this.view.navigateToStories()):this.view.showLoginError(n.message),t.n=7;break;case 6:t.p=6,i=t.v,console.error("Login error:",i),this.view.showLoginError(i.message);case 7:return t.p=7,this.view.hideLoginLoading(),t.f(7);case 8:return t.a(2)}},t,this,[[0,6,7,8]])})),function(t){return n.apply(this,arguments)})},{key:"registerUser",value:(r=ge(he().m(function t(e){var r,n,o,i;return he().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,this.view.showRegisterLoading(),r=Date.now(),t.n=1,this.model.register(e);case 1:if(n=t.v,!((o=Date.now()-r)<2e3)){t.n=3;break}return t.n=2,new Promise(function(t){return setTimeout(t,2e3-o)});case 2:t.n=4;break;case 3:case 4:n.success?(this.view.showRegisterSuccess(n.message),this.view.hideRegisterForm()):this.view.showRegisterError(n.message),t.n=6;break;case 5:t.p=5,i=t.v,console.error("Registration error:",i),this.view.showRegisterError(i.message);case 6:return t.p=6,this.view.hideRegisterLoading(),t.f(6);case 7:return t.a(2)}},t,this,[[0,5,6,7]])})),function(t){return r.apply(this,arguments)})}],e&&we(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function Oe(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Ee(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Ee(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ee(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ee(f,"constructor",s),Ee(s,"constructor",u),u.displayName="GeneratorFunction",Ee(s,o,"GeneratorFunction"),Ee(f),Ee(f,o,"Generator"),Ee(f,n,function(){return this}),Ee(f,"toString",function(){return"[object Generator]"}),(Oe=function(){return{w:i,m:p}})()}function Ee(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ee=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){Ee(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},Ee(t,e,r,n)}function Pe(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Te(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){Pe(i,n,o,a,c,"next",t)}function c(t){Pe(i,n,o,a,c,"throw",t)}a(void 0)})}}function Le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ae(n.key),n)}}function Ae(t){var e=function(t){if("object"!=je(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==je(e)?e:e+""}var Fe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new de,this.presenter=new Se(this.model,this)},e=[{key:"render",value:function(){this.initLoginForm(),this.initRegisterForm()}},{key:"initLoginForm",value:function(){var t=this;document.getElementById("login-form").addEventListener("submit",function(){var e=Te(Oe().m(function e(r){return Oe().w(function(e){for(;;)switch(e.n){case 0:return r.preventDefault(),e.n=1,t.handleLogin();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"initRegisterForm",value:function(){var t=this,e=document.getElementById("register-form");e&&e.addEventListener("submit",function(){var e=Te(Oe().m(function e(r){return Oe().w(function(e){for(;;)switch(e.n){case 0:return r.preventDefault(),e.n=1,t.handleRegister();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"handleLogin",value:(n=Te(Oe().m(function t(){var e,r;return Oe().w(function(t){for(;;)switch(t.n){case 0:return e=document.getElementById("email").value,r=document.getElementById("password").value,t.n=1,this.presenter.loginUser({email:e,password:r});case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"handleRegister",value:(r=Te(Oe().m(function t(){var e,r,n;return Oe().w(function(t){for(;;)switch(t.n){case 0:return e=document.getElementById("register-name").value,r=document.getElementById("register-email").value,n=document.getElementById("register-password").value,t.n=1,this.presenter.registerUser({name:e,email:r,password:n});case 1:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"showLoginLoading",value:function(){var t=document.getElementById("login-button");t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> <span>Login</span>'}},{key:"hideLoginLoading",value:function(){var t=document.getElementById("login-button");t.disabled=!1,t.innerHTML='<i class="fas fa-sign-in-alt" aria-hidden="true"></i> <span>Login</span>'}},{key:"showRegisterLoading",value:function(){var t=document.getElementById("register-button");t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Mendaftar...'}},{key:"hideRegisterLoading",value:function(){var t=document.getElementById("register-button");t.disabled=!1,t.innerHTML='<i class="fas fa-user-plus" aria-hidden="true"></i> Daftar'}},{key:"showLoginError",value:function(t){var e=document.getElementById("login-form"),r=e.querySelector(".error-message");r||((r=document.createElement("div")).className="error-message",e.prepend(r)),r.innerHTML='\n            <i class="fas fa-exclamation-circle"></i>\n            <p>'.concat(t||"Login gagal. Periksa email dan password Anda.","</p>\n        ")}},{key:"showRegisterError",value:function(t){var e=document.getElementById("register-form"),r=e.querySelector(".error-message");r||((r=document.createElement("div")).className="error-message",e.prepend(r)),r.innerHTML='\n            <i class="fas fa-exclamation-circle"></i>\n            <p>'.concat(t||"Registrasi gagal. Silakan coba lagi.","</p>\n        ")}},{key:"showRegisterSuccess",value:function(t){var e=document.getElementById("register-form"),r=document.createElement("div");r.className="success-message",r.innerHTML='\n            <i class="fas fa-check-circle"></i>\n            <p>'.concat(t||"Registrasi berhasil! Silakan login.","</p>\n        "),e.prepend(r),setTimeout(function(){r.remove()},5e3)}},{key:"navigateToStories",value:function(){window.location.hash="stories"}},{key:"showRegisterForm",value:function(){document.getElementById("register-section").style.display="block"}},{key:"hideRegisterForm",value:function(){document.getElementById("register-section").style.display="none"}}],e&&Le(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function Ge(t){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ge(t)}function _e(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return xe(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(xe(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,xe(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,xe(f,"constructor",s),xe(s,"constructor",u),u.displayName="GeneratorFunction",xe(s,o,"GeneratorFunction"),xe(f),xe(f,o,"Generator"),xe(f,n,function(){return this}),xe(f,"toString",function(){return"[object Generator]"}),(_e=function(){return{w:i,m:p}})()}function xe(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}xe=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){xe(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},xe(t,e,r,n)}function Ie(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ne(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){Ie(i,n,o,a,c,"next",t)}function c(t){Ie(i,n,o,a,c,"throw",t)}a(void 0)})}}function Ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,De(n.key),n)}}function De(t){var e=function(t){if("object"!=Ge(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ge(e)?e:e+""}var Be=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiService=new g,this.storageService=new j,this.publicVapidKey="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"},e=[{key:"subscribeToNotifications",value:(c=Ne(_e().m(function t(e){var r,n,o;return _e().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,r=this.storageService.getToken()){t.n=1;break}throw new Error("Anda harus login untuk menerima notifikasi.");case 1:return console.log("[Notification] Attempting to subscribe with token:",r),console.log("[Notification] Subscription object:",e),t.n=2,this.apiService.subscribeNotification(e,r);case 2:return n=t.v,console.log("[Notification] Subscribe response:",n),t.a(2,this.apiService.validateResponse(n));case 3:throw t.p=3,o=t.v,console.error("[Notification] Failed to subscribe:",o),o;case 4:return t.a(2)}},t,this,[[0,3]])})),function(t){return c.apply(this,arguments)})},{key:"unsubscribeFromNotifications",value:(a=Ne(_e().m(function t(e){var r,n,o;return _e().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,console.log("[Notification] Starting unsubscribe process..."),r=this.storageService.getToken()){t.n=1;break}return console.log("[Notification] No token found for unsubscribe"),t.a(2,{success:!1});case 1:return console.log("[Notification] Unsubscribing endpoint:",e),t.n=2,this.apiService.unsubscribeNotification({endpoint:e},r);case 2:return n=t.v,console.log("[Notification] Unsubscribe response:",n),t.a(2,this.apiService.validateResponse(n));case 3:throw t.p=3,o=t.v,console.error("[Notification] Failed to unsubscribe:",o),o;case 4:return t.a(2)}},t,this,[[0,3]])})),function(t){return a.apply(this,arguments)})},{key:"checkNotificationPermission",value:(i=Ne(_e().m(function t(){return _e().w(function(t){for(;;)switch(t.n){case 0:if(console.log("[Notification] Checking notification permission..."),"Notification"in window){t.n=1;break}return console.log("[Notification] Notifications not supported in this browser"),t.a(2,"not-supported");case 1:if(console.log("[Notification] Current permission status:",Notification.permission),"granted"!==Notification.permission){t.n=2;break}return t.a(2,"granted");case 2:if("denied"!==Notification.permission){t.n=3;break}return t.a(2,"denied");case 3:return t.a(2,"default");case 4:return t.a(2)}},t)})),function(){return i.apply(this,arguments)})},{key:"requestNotificationPermission",value:(o=Ne(_e().m(function t(){var e;return _e().w(function(t){for(;;)switch(t.n){case 0:if("Notification"in window){t.n=1;break}throw new Error("Browser tidak mendukung notifikasi.");case 1:return t.n=2,Notification.requestPermission();case 2:return e=t.v,t.a(2,e)}},t)})),function(){return o.apply(this,arguments)})},{key:"registerServiceWorker",value:(n=Ne(_e().m(function t(){var e,r;return _e().w(function(t){for(;;)switch(t.n){case 0:if("serviceWorker"in navigator){t.n=1;break}throw new Error("Browser tidak mendukung service worker.");case 1:return t.p=1,t.n=2,navigator.serviceWorker.register("/sw.js");case 2:return e=t.v,t.a(2,e);case 3:throw t.p=3,r=t.v,console.error("Service worker registration failed:",r),r;case 4:return t.a(2)}},t,null,[[1,3]])})),function(){return n.apply(this,arguments)})},{key:"createSubscription",value:(r=Ne(_e().m(function t(e){var r,n;return _e().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,console.log("[Notification] Starting subscription creation..."),console.log("[Notification] Using VAPID key:",this.publicVapidKey),t.n=1,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.publicVapidKey)});case 1:return r=t.v,console.log("[Notification] Subscription created successfully:",r),t.a(2,r);case 2:throw t.p=2,n=t.v,console.error("[Notification] Failed to create push subscription:",n),n;case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return r.apply(this,arguments)})},{key:"urlBase64ToUint8Array",value:function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(e),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);return n}},{key:"showLocalNotification",value:function(t,e){"Notification"in window&&"granted"===Notification.permission&&new Notification(t,e)}}],e&&Ce(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c}();function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}function Re(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Ue(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Ue(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Ue(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Ue(f,"constructor",s),Ue(s,"constructor",u),u.displayName="GeneratorFunction",Ue(s,o,"GeneratorFunction"),Ue(f),Ue(f,o,"Generator"),Ue(f,n,function(){return this}),Ue(f,"toString",function(){return"[object Generator]"}),(Re=function(){return{w:i,m:p}})()}function Ue(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Ue=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){Ue(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},Ue(t,e,r,n)}function He(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function qe(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){He(i,n,o,a,c,"next",t)}function c(t){He(i,n,o,a,c,"throw",t)}a(void 0)})}}function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ve(n.key),n)}}function Ve(t){var e=function(t){if("object"!=Me(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Me(e)?e:e+""}var Ke=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.router=new c,this.authModel=new de,this.notificationModel=new Be},e=[{key:"init",value:(o=qe(Re().m(function t(){return Re().w(function(t){for(;;)switch(t.n){case 0:if(this.setupRoutes(),this.router.init(),this.setupMobileMenu(),this.updateAuthUI(),this.checkAuth(),!this.authModel.isAuthenticated()){t.n=1;break}return t.n=1,this.initNotifications();case 1:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"setupRoutes",value:function(){var t=this;this.router.addRoute("home",qe(Re().m(function e(){var r;return Re().w(function(e){for(;;)switch(e.n){case 0:return r=new wt,e.n=1,r.render();case 1:t.updateAuthUI();case 2:return e.a(2)}},e)}))),this.router.addRoute("stories",qe(Re().m(function e(){var r;return Re().w(function(e){for(;;)switch(e.n){case 0:return r=new Ut,e.n=1,r.render();case 1:t.updateAuthUI();case 2:return e.a(2)}},e)}))),this.router.addRoute("add-story",qe(Re().m(function e(){var r;return Re().w(function(e){for(;;)switch(e.n){case 0:return r=new ie,e.n=1,r.render();case 1:t.updateAuthUI();case 2:return e.a(2)}},e)}))),this.router.addRoute("login",qe(Re().m(function e(){var r;return Re().w(function(e){for(;;)switch(e.n){case 0:return r=new Fe,e.n=1,r.render();case 1:t.updateAuthUI();case 2:return e.a(2)}},e)}))),this.router.addRoute("logout",qe(Re().m(function e(){return Re().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.handleLogout();case 1:return e.a(2)}},e)}))),this.router.addRoute("",qe(Re().m(function e(){return Re().w(function(e){for(;;)switch(e.n){case 0:t.router.navigate("home");case 1:return e.a(2)}},e)})))}},{key:"setupMobileMenu",value:function(){var t=document.getElementById("mobile-menu-btn"),e=document.getElementById("nav-links");t.addEventListener("click",function(){var r="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",!r),t.classList.toggle("active"),e.classList.toggle("active")}),document.addEventListener("click",function(r){r.target.closest("#mobile-menu-btn")||r.target.closest("#nav-links")||!e.classList.contains("active")||(e.classList.remove("active"),t.classList.remove("active"),t.setAttribute("aria-expanded","false"))}),e.addEventListener("click",function(r){"A"===r.target.tagName&&(e.classList.remove("active"),t.classList.remove("active"),t.setAttribute("aria-expanded","false"))}),document.addEventListener("keydown",function(r){"Escape"===r.key&&e.classList.contains("active")&&(e.classList.remove("active"),t.classList.remove("active"),t.setAttribute("aria-expanded","false"))})}},{key:"updateAuthUI",value:function(){var t=this,e=document.getElementById("auth-nav-item"),r=document.getElementById("auth-nav-link");e&&r&&(this.authModel.isAuthenticated()?(r.innerHTML='<i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout',r.href="#logout",r.onclick=function(e){e.preventDefault(),t.handleLogout()},r.classList.add("logout")):(r.innerHTML='<i class="fas fa-sign-in-alt" aria-hidden="true"></i> Login',r.href="#login",r.onclick=null,r.classList.remove("logout")))}},{key:"handleLogout",value:(n=qe(Re().m(function t(){var e,r,n;return Re().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.authModel.logout();case 1:if(this.updateAuthUI(),this.router.navigate("login"),!("serviceWorker"in navigator)){t.n=4;break}return t.n=2,navigator.serviceWorker.ready;case 2:return e=t.v,t.n=3,e.pushManager.getSubscription();case 3:if(!(r=t.v)){t.n=4;break}return t.n=4,this.notificationModel.unsubscribeFromNotifications(r.endpoint);case 4:t.n=6;break;case 5:t.p=5,n=t.v,console.error("Logout failed:",n);case 6:return t.a(2)}},t,this,[[0,5]])})),function(){return n.apply(this,arguments)})},{key:"checkAuth",value:function(){var t=this.router.getCurrentRoute(),e="login"===t||"logout"===t;this.authModel.isAuthenticated()||e?this.authModel.isAuthenticated()&&"login"===t&&this.router.navigate("home"):this.router.navigate("login")}},{key:"initNotifications",value:(r=qe(Re().m(function t(){var e,r,n,o;return Re().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.notificationModel.checkNotificationPermission();case 1:if("default"!==(e=t.v)){t.n=4;break}return t.n=2,this.notificationModel.requestNotificationPermission();case 2:if("granted"===t.v){t.n=3;break}return t.a(2);case 3:t.n=5;break;case 4:if("granted"===e){t.n=5;break}return t.a(2);case 5:return t.n=6,this.notificationModel.registerServiceWorker();case 6:return r=t.v,t.n=7,this.notificationModel.createSubscription(r);case 7:return n=t.v,t.n=8,this.notificationModel.subscribeToNotifications(n);case 8:console.log("Push notifications subscribed"),t.n=10;break;case 9:t.p=9,o=t.v,console.error("Notification setup failed:",o);case 10:return t.a(2)}},t,this,[[0,9]])})),function(){return r.apply(this,arguments)})}],e&&ze(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();document.addEventListener("DOMContentLoaded",qe(Re().m(function t(){var e;return Re().w(function(t){for(;;)switch(t.n){case 0:return e=new Ke,t.n=1,e.init();case 1:window.navigateToPage=function(t){e.router.navigate(t)},window.showRegisterForm=function(){document.getElementById("register-section").style.display="block"};case 2:return t.a(2)}},t)}))),Ke.prototype.updateOnlineStatus=function(){var t=document.createElement("div");t.id="network-status",t.style.position="fixed",t.style.bottom="10px",t.style.right="10px",t.style.padding="8px 16px",t.style.borderRadius="20px",t.style.zIndex="1000",navigator.onLine?(t.textContent="Online",t.style.background="var(--success-gradient)"):(t.textContent="Offline",t.style.background="var(--secondary-gradient)"),document.body.appendChild(t),window.addEventListener("online",function(){t.textContent="Online",t.style.background="var(--success-gradient)",setTimeout(function(){t.remove()},3e3)}),window.addEventListener("offline",function(){t.textContent="Offline",t.style.background="var(--secondary-gradient)"})};const We=Ke;function Je(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return $e(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return i=e,c=0,u=t,p.n=r,a}};function y(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,d=i[2];r>3?(o=d===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=r<2&&y<i[1])?(c=0,p.v=n,p.n=i[1]):y<d&&(o=r<3||i[0]>n||n>d)&&(i[4]=r,i[5]=n,p.n=d,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,d),c=l,u=d;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(p.n=-1),y(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):($e(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,$e(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,$e(f,"constructor",s),$e(s,"constructor",u),u.displayName="GeneratorFunction",$e(s,o,"GeneratorFunction"),$e(f),$e(f,o,"Generator"),$e(f,n,function(){return this}),$e(f,"toString",function(){return"[object Generator]"}),(Je=function(){return{w:i,m:p}})()}function $e(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}$e=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){$e(t,e,function(t){return this._invoke(e,r,t)})};i("next",0),i("throw",1),i("return",2)}},$e(t,e,r,n)}function Qe(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Xe(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){Qe(i,n,o,a,c,"next",t)}function c(t){Qe(i,n,o,a,c,"throw",t)}a(void 0)})}}document.addEventListener("DOMContentLoaded",Xe(Je().m(function t(){var e;return Je().w(function(t){for(;;)switch(t.n){case 0:return e=new We,t.n=1,e.init();case 1:window.addEventListener("hashchange",Xe(Je().m(function t(){return Je().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.init();case 1:return t.a(2)}},t)})));case 2:return t.a(2)}},t)})))})();